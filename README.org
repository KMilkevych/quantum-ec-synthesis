#+title: Quantum EC Synthesis (QECS)
#+author: Kostiantyn V. Milkevych

[[file:banner.svg]]

#+begin_src sh :exports none :session mysession :results silent
export COLUMNS=100
#+end_src

* Usage
To run the tool simply execute ~poetry run src/main.py~ and specify a sub-command, or run
#+name: mainhelp
#+begin_src sh :results output :exports both :session mysession
poetry run src/main.py --help
#+end_src

to see usage information:

#+RESULTS: mainhelp
#+begin_example
usage: main.py [-h] [-v {0,1}] {synthesize,simulate,generate,experiment,other} ...

Quantum Error-Correction Code Synthesis for Fault-Tolerant computation.

positional arguments:
  {synthesize,simulate,generate,experiment,other}
                        Commands

options:
  -h, --help            show this help message and exit
  -v, --verbose {0,1}   turn on verbose output (default: 1)
#+end_example


** Error-Correcting Code Synthesis

#+begin_src sh :results output :exports results :session mysession
poetry run src/main.py synthesize --help
#+end_src

#+RESULTS:
#+begin_example
usage: main.py synthesize [-h] [-m {steane,3-bit}] [-ecf ERROR_CORRECTION_FREQUENCY]
                          [-o OUTPUT] [-opt {qiskit,q-synth}]
                          input_circuit

Perform synthesis of Quantum Error-Correcting Codes onto existing circuits.

positional arguments:
  input_circuit         .qasm file containing input circuit

options:
  -h, --help            show this help message and exit
  -m, --method {steane,3-bit}
                        synthesis method (default: steane)
  -ecf, --error-correction-frequency ERROR_CORRECTION_FREQUENCY
                        Frequency of error-correction insertion. 0=only before each
                        measurement. (default: 1)
  -o, --output OUTPUT   .qasm file for storing output circuit (default: None)
  -opt, --optimize {qiskit,q-synth}
                        optimize error-correcting machinery (default: None)
#+end_example

** Sample circuit generation

#+begin_src sh :results output :exports results :session mysession
poetry run src/main.py generate --help
#+end_src

#+RESULTS:
#+begin_example
usage: main.py generate [-h] [-k {all,identity,x,h,x-chain,entangle,random-clifford}] [-q QUBITS]
                        [-gc GATE_COUNT] [-f {qasm2,qasm3}] [-o OUTPUT]

Generate example quantum circuits.

options:
  -h, --help            show this help message and exit
  -k, --kind {all,identity,x,h,x-chain,entangle,random-clifford}
                        circuit to generate (default: all)
  -q, --qubits QUBITS   circuit size (no. logical qubits) (default: 1)
  -gc, --gate-count GATE_COUNT
                        circuit size (no. logical gates) (default: 32)
  -f, --format {qasm2,qasm3}
                        circuit size (no. logical gates) (default: qasm3)
  -o, --output OUTPUT   output file/directory for storing output circuits (default: None)
#+end_example

** Exact and Noisy simulation

#+begin_src sh :results output :exports results :session mysession
poetry run src/main.py simulate --help
#+end_src

#+RESULTS:
#+begin_example
usage: main.py simulate [-h] [-s SAMPLES] [-nt {z,x,zx,superconductor}]
                        [-na NOISE_AMPLITUDE] [--plot PLOT] [--csv CSV]
                        input_circuit [input_circuit ...]

Perform exact and noisy simulations of existing circuits.

positional arguments:
  input_circuit         .qasm file(s) containing input circuit(s)

options:
  -h, --help            show this help message and exit
  -s, --samples SAMPLES
                        no. of samples/simulations (default: 1000)
  -nt, --noise-type {z,x,zx,superconductor}
                        type of noise model to simulate with (default: None)
  -na, --noise-amplitude NOISE_AMPLITUDE
                        probability of basic error in noise model (default: 0.01)
  --plot PLOT           .png file to plot simulation measurements (default: None)
  --csv CSV             .csv file to store simulation measurements (default: None)
#+end_example

** Noise Experiments

#+begin_src sh :results output :exports results :session mysession
poetry run src/main.py experiment --help
#+end_src

#+RESULTS:
#+begin_example
usage: main.py experiment [-h] [-p P_ERROR] [-ec ERROR_CORRECT] [-d CIRCUIT_DEPTH]
                          [-s SAMPLES] [-m {steane,3-bit}]
                          {circuit-depth,error-rate,correction-frequency,clifford-gate-count,clifford-error-rate}

Perform experiments.

positional arguments:
  {circuit-depth,error-rate,correction-frequency,clifford-gate-count,clifford-error-rate}
                        Which experiment to perform

options:
  -h, --help            show this help message and exit
  -p, --p-error P_ERROR
                        Probability of error (default: 0.01)
  -ec, --error-correct ERROR_CORRECT
                        How often to perform error-correction (default: 30)
  -d, --circuit_depth CIRCUIT_DEPTH
                        How deep a circuit to generate (default: 1024)
  -s, --samples SAMPLES
                        How many samples to measure (default: 1000)
  -m, --method {steane,3-bit}
                        synthesis method (default: steane)
#+end_example


* Examples
** Noise simulation on error-corrected circuits

*** Circuit Generation
First run the ~generate~ command to generate a base circuit:
#+name: circuitgen
#+begin_src sh :exports both :results output :session mysession
poetry run src/main.py generate -k x -q 1 -o circuit.qasm
#+end_src
which gives output:
#+RESULTS: circuitgen
: GENERATED x-circuit:
:          ┌───┐┌─┐
:   q_dat: ┤ X ├┤M├
:          └───┘└╥┘
: c_dat: 1/══════╩═
:                0


*** Error-correction synthesis
Next, encode the circuit with an error-correcting code:
#+name: ecfexample
#+begin_src sh :exports both :results output :session mysession
poetry run src/main.py synthesize circuit.qasm -m 3-bit -ecf 0 -o ec-circuit.qasm
#+end_src

#+RESULTS: ecfexample
#+begin_example
INPUT CIRCUIT:
         ┌───┐┌─┐
  q_dat: ┤ X ├┤M├
         └───┘└╥┘
c_dat: 1/══════╩═
               0
OUTPUT CIRCUIT:
                    ┌───┐                            ┌────── ┌───┐ ───────┐                   »
q_log0_0: ──■────■──┤ X ├──■─────────────────────────┤ If-0  ┤ X ├  End-0 ├───────────────────»
          ┌─┴─┐  │  ├───┤  │                         └──╥─── └───┘ ───────┘                   »
q_log0_1: ┤ X ├──┼──┤ X ├──┼────■────■──────────────────╫─────────────────────────────────────»
          └───┘┌─┴─┐├───┤  │    │    │                  ║                        ┌────── ┌───┐»
q_log0_2: ─────┤ X ├┤ X ├──┼────┼────┼───────■──────────╫────────────────────────┤ If-0  ┤ X ├»
               └───┘└───┘┌─┴─┐┌─┴─┐  │  ┌─┐  │          ║                        └──╥─── └───┘»
 q_anc_0: ───────────────┤ X ├┤ X ├──┼──┤M├──┼───|0>────╫───────────────────────────╫─────────»
                         └───┘└───┘┌─┴─┐└╥┘┌─┴─┐ ┌─┐    ║                           ║         »
 q_anc_1: ─────────────────────────┤ X ├─╫─┤ X ├─┤M├────╫────────────────────|0>────╫─────────»
                                   └───┘ ║ └───┘ └╥┘    ║                           ║         »
 c_dat: 1/═══════════════════════════════╬════════╬═════╬═══════════════════════════╬═════════»
                                         ║        ║  ┌──╨──┐                     ┌──╨──┐      »
 c_anc: 2/═══════════════════════════════╩════════╩══╡ 0x1 ╞═════════════════════╡ 0x2 ╞══════»
                                         0        1  └─────┘                     └─────┘      »
«                                                     ┌─┐
«q_log0_0: ───────────────────────────────────■────■──┤M├
«                    ┌────── ┌───┐ ───────┐   │  ┌─┴─┐└╥┘
«q_log0_1: ──────────┤ If-0  ┤ X ├  End-0 ├───┼──┤ X ├─╫─
«           ───────┐ └──╥─── └───┘ ───────┘ ┌─┴─┐└───┘ ║
«q_log0_2:   End-0 ├────╫───────────────────┤ X ├──────╫─
«           ───────┘    ║                   └───┘      ║
« q_anc_0: ─────────────╫──────────────────────────────╫─
«                       ║                              ║
« q_anc_1: ─────────────╫──────────────────────────────╫─
«                       ║                              ║
« c_dat: 1/═════════════╬══════════════════════════════╩═
«                    ┌──╨──┐                           0
« c_anc: 2/══════════╡ 0x3 ╞═════════════════════════════
«                    └─────┘
#+end_example

*** Noise simulation
Lastly, perform noise simulations with the ~simulate~ command to benchmark the error-corrected circuit:

#+name: noiseexample
#+begin_src sh :exports both :results output :session mysession
poetry run src/main.py simulate circuit.qasm ec-circuit.qasm -s 1000 -nt x -na 0.01 --plot figure.png --csv data.csv
#+end_src

#+RESULTS:
#+begin_example
INPUT CIRCUIT:
         ┌───┐┌─┐
  q_dat: ┤ X ├┤M├
         └───┘└╥┘
c_dat: 1/══════╩═
               0
1000 SIMULATIONS:
{'1': 992, '0': 8}
INPUT CIRCUIT:
                    ┌───┐                            ┌────── ┌───┐ ───────┐                   »
q_log0_0: ──■────■──┤ X ├──■─────────────────────────┤ If-0  ┤ X ├  End-0 ├───────────────────»
          ┌─┴─┐  │  ├───┤  │                         └──╥─── └───┘ ───────┘                   »
q_log0_1: ┤ X ├──┼──┤ X ├──┼────■────■──────────────────╫─────────────────────────────────────»
          └───┘┌─┴─┐├───┤  │    │    │                  ║                        ┌────── ┌───┐»
q_log0_2: ─────┤ X ├┤ X ├──┼────┼────┼───────■──────────╫────────────────────────┤ If-0  ┤ X ├»
               └───┘└───┘┌─┴─┐┌─┴─┐  │  ┌─┐  │          ║                        └──╥─── └───┘»
 q_anc_0: ───────────────┤ X ├┤ X ├──┼──┤M├──┼───|0>────╫───────────────────────────╫─────────»
                         └───┘└───┘┌─┴─┐└╥┘┌─┴─┐ ┌─┐    ║                           ║         »
 q_anc_1: ─────────────────────────┤ X ├─╫─┤ X ├─┤M├────╫────────────────────|0>────╫─────────»
                                   └───┘ ║ └───┘ └╥┘    ║                           ║         »
 c_dat: 1/═══════════════════════════════╬════════╬═════╬═══════════════════════════╬═════════»
                                         ║        ║  ┌──╨──┐                     ┌──╨──┐      »
 c_anc: 2/═══════════════════════════════╩════════╩══╡ 0x1 ╞═════════════════════╡ 0x2 ╞══════»
                                         0        1  └─────┘                     └─────┘      »
«                                                     ┌─┐
«q_log0_0: ───────────────────────────────────■────■──┤M├
«                    ┌────── ┌───┐ ───────┐   │  ┌─┴─┐└╥┘
«q_log0_1: ──────────┤ If-0  ┤ X ├  End-0 ├───┼──┤ X ├─╫─
«           ───────┐ └──╥─── └───┘ ───────┘ ┌─┴─┐└───┘ ║
«q_log0_2:   End-0 ├────╫───────────────────┤ X ├──────╫─
«           ───────┘    ║                   └───┘      ║
« q_anc_0: ─────────────╫──────────────────────────────╫─
«                       ║                              ║
« q_anc_1: ─────────────╫──────────────────────────────╫─
«                       ║                              ║
« c_dat: 1/═════════════╬══════════════════════════════╩═
«                    ┌──╨──┐                           0
« c_anc: 2/══════════╡ 0x3 ╞═════════════════════════════
«                    └─────┘
1000 SIMULATIONS:
{'0': 57, '1': 943}
#+end_example

This generates a histogram over the measurements in the file =figure.png= and a data file =data.csv= storing the exact numbers:

#+NAME: table
#+CAPTION: Stored simulation data
| circuit         |  0 |   1 |
| circuit.qasm    |  8 | 992 |
| ec-circuit.qasm | 57 | 943 |

* Installation
To install QECS clone the repository and run
#+begin_src sh
poetry install
#+end_src
this will install all required dependencies and allow you to invoke
#+begin_example
poetry run src/main.py
#+end_example
* Disabled Q-Synth functionality
Due to an issue with Q-Synth, optimization of ec codes using Q-Synth is temporarily disabled. As such the dependency has been commented out from the =pyproject.toml= file.
